
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Chao's Random Thoughts</title>
  <meta name="author" content="Chao Chu">

  
  <meta name="description" content="Introduction
This module provides support for maintaining a list in sorted order without
having to sort the list after each insertion. It uses a &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://chuchao333.github.com/">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Chao's Random Thoughts" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript"
   src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Chao's Random Thoughts</a></h1>
  
    <h2>Keep looking, don't settle</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:chuchao333.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/19/python-bisect/">Python Bisect</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-19T20:01:00+08:00" pubdate data-updated="true">Aug 19<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class="section" id="introduction">
<h2>Introduction</h2>
<p>This module provides support for maintaining a list in sorted order without
having to sort the list after each insertion. It uses a basic bisection
algorithm similar with the classic binary search.</p>
</div>
<div class="section" id="review-of-binary-search">
<h2>Review of binary search</h2>
<p>According to <a class="reference external" href="http://www.amazon.com/Programming-Pearls-2nd-Edition-Bentley/dp/0201657880/ref=sr_1_1?ie=UTF8&amp;qid=1345379618&amp;sr=8-1&amp;keywords=programming+pearls">&#8216;Programming Pearls&#8217;</a>
by Jon Bentley, It&#8217;s very hard to write a correct binary search(Unbelievable, Uh?).
Below is the note from the book:</p>
<blockquote class="highlights">
I&#8217;ve assigned [binary search] in courses at Bell Labs and IBM.
Professional programmers had a couple of hours to convert [its] description
into a program in the language of their choice; a high-level pseudocode
was fine. At the end of the speci?ed time, almost all the programmers
reported that they had correct code for the task. We would then take thirty
minutes to examine their code, which the programmers did with test cases.
In several classes and with over a hundred programmers, the results varied
little: ninety percent of the programmers found bugs in their programs (and
I wasn&#8217;t always convinced of the correctness of the code in which no bugs were
found). I was amazed: given ample time, only about ten percent of professional
programmers were able to get this small program right. But they aren&#8217;t the only
ones to ?nd this task difficult: in the history in Section 6.2.1 of his
&#8216;Sorting and Searching&#8217;, Knuth points out that while the first binary search
was published in 1946, the first published binary search without bugs did not
appear until 1962.</blockquote>
<p>Understanding how to use loop invariants in composing a program is very important,
so let&#8217;s first implement a binary search and prove the correctness utilizing this.
Here we use a simplified specification compared to the bsearch function in the C
standard library.</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
</pre></td><td class="code"><pre><code class="cpp"><span class="line"><span class="kt">int</span> <span class="n">binsearch</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">A</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
</span><span class="line"><span class="c1">// @require 0 &lt;= n &amp;&amp; n &lt;= length(A)</span>
</span><span class="line"><span class="c1">// @require is_sorted(A, n)</span>
</span><span class="line"><span class="cm">/* @ensures (-1 == result &amp;&amp; !is_in(x, A, n))</span>
</span><span class="line"><span class="cm">            || ((0 &lt;= result &amp;&amp; result &lt; n) &amp;&amp; A[result] == x)</span>
</span><span class="line"><span class="cm">*/</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="kt">int</span> <span class="n">lower</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">higher</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span>
</span><span class="line">    <span class="kt">int</span> <span class="n">mid</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">    <span class="k">while</span> <span class="p">(</span><span class="n">lower</span> <span class="o">&lt;</span> <span class="n">higher</span><span class="p">)</span>
</span><span class="line">    <span class="c1">// @loop_invariant 0 &lt;= lower &amp;&amp; lower &lt;= higher &amp;&amp; higher &lt;= n</span>
</span><span class="line">    <span class="c1">// @loop_invariant (lower == 0 || A[lower - 1] &lt; x)</span>
</span><span class="line">    <span class="c1">// @loop_invariant (higher == n || A[higher] &gt; x)</span>
</span><span class="line">    <span class="p">{</span>
</span><span class="line">        <span class="n">mid</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="p">(</span><span class="n">higher</span> <span class="o">-</span> <span class="n">lower</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
</span><span class="line">        <span class="c1">// @assert lower &lt;= mid &amp;&amp; mid &lt; higher</span>
</span><span class="line">        <span class="k">if</span> <span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span>
</span><span class="line">            <span class="k">return</span> <span class="n">mid</span><span class="p">;</span>
</span><span class="line">        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">)</span>
</span><span class="line">            <span class="n">lower</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span><span class="line">        <span class="k">else</span>
</span><span class="line">            <span class="n">higher</span> <span class="o">=</span> <span class="n">mid</span><span class="p">;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure><p>It&#8217;s easy to prove that the loop invariants are strong enough to imple the
postcodition of the function(&#64;ensures). Does this function terminate? In the
loop body, we have lower &lt; higher, so lower &lt;= mid &amp;&amp; mid &lt; higher, then the
intervals from <em>lower</em> to <em>mid</em> and from <em>(mid+1)</em> to <em>higher</em> are strictly
smaller than the original interval (lower, higher), unless we find the element,
the difference between higher and lower will eventually become 0 and we will
exit the loop.</p>
<p><strong>The bisect() functions provided in this module are useful for finding the
insertion points but can be tricky or awkward to use for common searching
tasks.</strong></p>
</div>
<div class="section" id="code-comments">
<h2>Code comments</h2>
<p>The above binsearch function will return the first of the elements that equals
to the target if there are more than one. Sometimes it&#8217;s required to find the
left most one or the right most one. We can achieve this by using the bisect()
functions. Let&#8217;s examine the pre and post conditions, and also loop invariants.</p>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">def</span> <span class="nf">bisect_right</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">lo</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</span><span class="line">
</span><span class="line">    <span class="c"># Let l be the original lo passed in, and h be hi. In order to differentiate.</span>
</span><span class="line">
</span><span class="line">    <span class="c"># @requires 0 &lt;= l &amp;&amp; l &lt; h &amp;&amp; h &lt;= len(a)</span>
</span><span class="line">    <span class="c"># @requires is_sorted(a[l:h])</span>
</span><span class="line">    <span class="c"># @ensures all e in a[l:result] have e &lt;= x, and all e in a[result:h] have e &gt; x</span>
</span><span class="line">
</span><span class="line">    <span class="k">while</span> <span class="n">lo</span> <span class="o">&lt;</span> <span class="n">hi</span><span class="p">:</span>
</span><span class="line">        <span class="c"># @loop_invariant l &lt;= lo &amp;&amp; lo &lt;= hi &amp;&amp; hi &lt;= h</span>
</span><span class="line">        <span class="c"># @loop_invariant lo == l || a[lo - 1] &lt;= x</span>
</span><span class="line">        <span class="c"># @loop_invariant hi == h || a[hi] &gt; x</span>
</span><span class="line">        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">lo</span> <span class="o">+</span> <span class="n">hi</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span><span class="line">        <span class="c"># @assert lower &lt;= mid &amp;&amp; mid &lt; higher</span>
</span><span class="line">        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">[</span><span class="n">mid</span><span class="p">]:</span>
</span><span class="line">            <span class="n">hi</span> <span class="o">=</span> <span class="n">mid</span>
</span><span class="line">        <span class="k">else</span><span class="p">:</span>
</span><span class="line">            <span class="n">lo</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class="line">    <span class="k">return</span> <span class="n">lo</span>
</span></code></pre></td></tr></table></div></figure><p>After exiting the loop, we have lo == hi. Now we have to distinguish some cases:</p>
<ul class="simple">
<li>If lo == l, from the third conjunct, we know that a[hi] &gt; x, and since lo == hi,
we have a[lo] &gt; x. In this case, all e in a[l:h] &gt; x</li>
<li>If hi == h, from the second conjunct, we know that a[lo - 1] &lt; x, in this case,
all e in a[l:h] &lt;= x</li>
<li>if lo != l and hi != h, from the second and third conjuncts, we know that
a[lo - 1] &lt;= x, a[hi] &gt; x. The post condition still holds.</li>
</ul>
<p>We can do the same analysis on the function bisect_left().</p>
<p>Note: In the pre condition I explicitly written down that lo &lt; hi is required, the
code will directly return lo when hi is less than or equal to lo, but that&#8217;s simply
meaningless, if this is the case, the sorted order of &#8216;a&#8217; after we insert element
before the index returned by the function.</p>
<div class="section" id="about-the-function-prototype">
<h3>About the function prototype</h3>
<p>In the doc of the module, it&#8217;s <strong>bisect.bisect_right(a, x, lo=0, hi=len(a))</strong>
while in the source code, it&#8217;s <strong>def bisect_left(a, x, lo=0, hi=None)</strong></p>
<p><strong>bisect.bisect_right(a, x, lo=0, hi=len(a))</strong> is not valid python code, you will
get error like this: <strong>NameError: name &#8216;a&#8217; is not defined.</strong> This is because default
values are computed and bound at the function definition time rather than when you
call the function. This means that you can&#8217;t have a default which is dependent on
something that is not known until the function is called.</p>
</div>
</div>
<div class="section" id="pythonic-stuff">
<h2>Pythonic stuff</h2>
<div class="section" id="override-function-definitions-in-python">
<h3>Override function definitions in Python</h3>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="c"># Overwrite above definitions with a fast C implementation</span>
</span><span class="line"><span class="k">try</span><span class="p">:</span>
</span><span class="line">    <span class="kn">from</span> <span class="nn">_bisect</span> <span class="kn">import</span> <span class="o">*</span>
</span><span class="line"><span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span class="line">    <span class="k">pass</span>
</span></code></pre></td></tr></table></div></figure></div>
<div class="section" id="gotcha-mutable-default-arguments">
<h3>Gotcha &#8211; Mutable default arguments</h3>
<p>See <a class="reference external" href="http://stackoverflow.com/questions/1132941/least-astonishment-in-python-the-mutable-default-argument">here</a>
for more details.</p>
</div>
</div></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/18/supporting-latex-in-octopress/">Support LaTex in Octopress</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-18T00:57:00+08:00" pubdate data-updated="true">Aug 18<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It took me some time to finally get latex math formulas working in Octopress.
If you googled ‘Octopress latex’, you can get quite a few online resources about
how to support latex in octopress, with various levels of complexity. In this
post, I will write down how I achieve this.</p>

<h2 id="the-initial-attempt">The initial attempt</h2>
<p>As I installed the <a href="https://github.com/xdissent/jekyll-rst">jekyll-rst</a> plugin
to use rst to write my posts, I thought it should be easy to write latex math
because docutils has native support for it since version 0.8 (A :math: role and
also a .. math: directive introduced for that). However, after I tried to use
these in a octopress post, I found that the post will be rendered to empty. For
example, if I insert the following rst code into my post, the whole post becomes
empty; but after removing this line, everything is fine.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">The area of a circle is :math:`A_\text{c} = (\pi/4) d^2`.</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>I also verified that the exact same code can be successfully converted to valid
html using the ‘rst2html.py’ script on my system, so I guess maybe something is
wrong in ‘RbST’. I found that in RbST, it has its own copies of rst2html and
rst2latex tools under ** /gems/RbST-0.1.3/lib/rst2parts **,</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="console"><span class="line"><span class="gp">chuchao@chuchao:~/.rvm/gems/ruby-1.9.2-p320/gems/RbST-0.1.3/lib/rst2parts$</span> ls
</span><span class="line"><span class="go">__init__.py  rst2html.py  rst2latex.py  transform.py  transform.pyc</span>
</span><span class="line"><span class="gp">chuchao@chuchao:~/.rvm/gems/ruby-1.9.2-p320/gems/RbST-0.1.3/lib/rst2parts$</span> ls ..
</span><span class="line"><span class="go">rbst.rb  rst2parts</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>which will be used in rbst.rb. I have even tried to change rbst.rb to use the
rst2html.py installed on my system, but this also didn’t get any luck.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">class</span> <span class="nc">RbST</span>
</span><span class="line">
</span><span class="line">  <span class="vc">@@executable_path</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">__FILE__</span><span class="p">),</span> <span class="s2">&quot;rst2parts&quot;</span><span class="p">))</span>
</span><span class="line">  <span class="vc">@@executables</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="line">    <span class="c1"># :html  =&gt; File.join(@@executable_path, &quot;rst2html.py&quot;),</span>
</span><span class="line">    <span class="ss">:html</span>  <span class="o">=&gt;</span> <span class="s2">&quot;/usr/local/bin/rst2html.py&quot;</span><span class="p">,</span>
</span><span class="line">    <span class="ss">:latex</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="vc">@@executable_path</span><span class="p">,</span> <span class="s2">&quot;rst2latex.py&quot;</span><span class="p">)</span>
</span><span class="line">  <span class="p">}</span>
</span><span class="line"><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Finally, I gave up on this and opened an
<a href="https://github.com/xdissent/jekyll-rst/issues/6">issue</a> on this for the jekyll-rst
plugin. Hope the author can fix this.</p>

<h2 id="switch-back-to-markdown-and-using-kramdown">Switch back to markdown and using kramdown</h2>
<p>After a google search about this issue, seems that the simplest solution is to use
kramdown, which has built-in support for latex.</p>

<p>First, install kramdown:
<code>gem install karmdown</code></p>

<p>Then, add mathjax configs into &lt;head&gt;&lt;/head&gt; tag, in octopress, just add the
below code into <code>/source/_includes/custom/head.html</code>:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
</pre></td><td class="code"><pre><code class="html"><span class="line"><span class="c">&lt;!-- mathjax config similar to math.stackexchange --&gt;</span>
</span><span class="line">
</span><span class="line"><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/x-mathjax-config&quot;</span><span class="nt">&gt;</span>
</span><span class="line">  <span class="nx">MathJax</span><span class="p">.</span><span class="nx">Hub</span><span class="p">.</span><span class="nx">Config</span><span class="p">({</span>
</span><span class="line">    <span class="nx">tex2jax</span><span class="o">:</span> <span class="p">{</span>
</span><span class="line">      <span class="nx">inlineMath</span><span class="o">:</span> <span class="p">[</span> <span class="p">[</span><span class="s1">&#39;$&#39;</span><span class="p">,</span><span class="s1">&#39;$&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;\\(&quot;</span><span class="p">,</span><span class="s2">&quot;\\)&quot;</span><span class="p">]</span> <span class="p">],</span>
</span><span class="line">      <span class="nx">processEscapes</span><span class="o">:</span> <span class="kc">true</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">  <span class="p">});</span>
</span><span class="line"><span class="nt">&lt;/script&gt;</span>
</span><span class="line">
</span><span class="line"><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/x-mathjax-config&quot;</span><span class="nt">&gt;</span>
</span><span class="line">    <span class="nx">MathJax</span><span class="p">.</span><span class="nx">Hub</span><span class="p">.</span><span class="nx">Config</span><span class="p">({</span>
</span><span class="line">      <span class="nx">tex2jax</span><span class="o">:</span> <span class="p">{</span>
</span><span class="line">        <span class="nx">skipTags</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;script&#39;</span><span class="p">,</span> <span class="s1">&#39;noscript&#39;</span><span class="p">,</span> <span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="s1">&#39;textarea&#39;</span><span class="p">,</span> <span class="s1">&#39;pre&#39;</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span><span class="p">]</span>
</span><span class="line">      <span class="p">}</span>
</span><span class="line">    <span class="p">});</span>
</span><span class="line"><span class="nt">&lt;/script&gt;</span>
</span><span class="line">
</span><span class="line"><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/x-mathjax-config&quot;</span><span class="nt">&gt;</span>
</span><span class="line">    <span class="nx">MathJax</span><span class="p">.</span><span class="nx">Hub</span><span class="p">.</span><span class="nx">Queue</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">        <span class="kd">var</span> <span class="nx">all</span> <span class="o">=</span> <span class="nx">MathJax</span><span class="p">.</span><span class="nx">Hub</span><span class="p">.</span><span class="nx">getAllJax</span><span class="p">(),</span> <span class="nx">i</span><span class="p">;</span>
</span><span class="line">        <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">all</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">            <span class="nx">all</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">SourceElement</span><span class="p">().</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">className</span> <span class="o">+=</span> <span class="s1">&#39; has-jax&#39;</span><span class="p">;</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">    <span class="p">});</span>
</span><span class="line"><span class="nt">&lt;/script&gt;</span>
</span><span class="line">
</span><span class="line"><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span>
</span><span class="line">   <span class="na">src=</span><span class="s">&quot;http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML&quot;</span><span class="nt">&gt;</span>
</span><span class="line"><span class="nt">&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>See <a href="http://kramdown.rubyforge.org/syntax.html#math-blocks">here</a> for more details.
After this, we are ready to test latex math in our post. For example:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
</pre></td><td class="code"><pre><code class="latex"><span class="line"><span class="sb">$$</span><span class="nb"></span>
</span><span class="line"><span class="nv">\begin</span><span class="nb">{align</span><span class="o">*</span><span class="nb">}</span>
</span><span class="line"><span class="nb">  &amp; </span><span class="nv">\phi</span><span class="o">(</span><span class="nb">x,y</span><span class="o">)</span><span class="nb"> </span><span class="o">=</span><span class="nb"> </span><span class="nv">\phi</span><span class="nb"> </span><span class="nv">\left</span><span class="o">(</span><span class="nv">\sum</span><span class="nb">_{i</span><span class="o">=</span><span class="m">1</span><span class="nb">}^n x_ie_i, </span><span class="nv">\sum</span><span class="nb">_{j</span><span class="o">=</span><span class="m">1</span><span class="nb">}^n y_je_j </span><span class="nv">\right</span><span class="o">)</span><span class="nb"></span>
</span><span class="line"><span class="nb">  </span><span class="o">=</span><span class="nb"> </span><span class="nv">\sum</span><span class="nb">_{i</span><span class="o">=</span><span class="m">1</span><span class="nb">}^n </span><span class="nv">\sum</span><span class="nb">_{j</span><span class="o">=</span><span class="m">1</span><span class="nb">}^n x_i y_j </span><span class="nv">\phi</span><span class="o">(</span><span class="nb">e_i, e_j</span><span class="o">)</span><span class="nb"> </span><span class="o">=</span><span class="nb"> </span><span class="nv">\\</span><span class="nb"></span>
</span><span class="line"><span class="nb">  &amp; </span><span class="o">(</span><span class="nb">x_</span><span class="m">1</span><span class="nb">, </span><span class="nv">\ldots</span><span class="nb">, x_n</span><span class="o">)</span><span class="nb"> </span><span class="nv">\left</span><span class="o">(</span><span class="nb"> </span><span class="nv">\begin</span><span class="nb">{array}{ccc}</span>
</span><span class="line"><span class="nb">      </span><span class="nv">\phi</span><span class="o">(</span><span class="nb">e_</span><span class="m">1</span><span class="nb">, e_</span><span class="m">1</span><span class="o">)</span><span class="nb"> &amp; </span><span class="nv">\cdots</span><span class="nb"> &amp; </span><span class="nv">\phi</span><span class="o">(</span><span class="nb">e_</span><span class="m">1</span><span class="nb">, e_n</span><span class="o">)</span><span class="nb"> </span><span class="nv">\\</span><span class="nb"></span>
</span><span class="line"><span class="nb">      </span><span class="nv">\vdots</span><span class="nb"> &amp; </span><span class="nv">\ddots</span><span class="nb"> &amp; </span><span class="nv">\vdots</span><span class="nb"> </span><span class="nv">\\</span><span class="nb"></span>
</span><span class="line"><span class="nb">      </span><span class="nv">\phi</span><span class="o">(</span><span class="nb">e_n, e_</span><span class="m">1</span><span class="o">)</span><span class="nb"> &amp; </span><span class="nv">\cdots</span><span class="nb"> &amp; </span><span class="nv">\phi</span><span class="o">(</span><span class="nb">e_n, e_n</span><span class="o">)</span><span class="nb"></span>
</span><span class="line"><span class="nb">    </span><span class="nv">\end</span><span class="nb">{array} </span><span class="nv">\right</span><span class="o">)</span><span class="nb"></span>
</span><span class="line"><span class="nb">  </span><span class="nv">\left</span><span class="o">(</span><span class="nb"> </span><span class="nv">\begin</span><span class="nb">{array}{c}</span>
</span><span class="line"><span class="nb">      y_</span><span class="m">1</span><span class="nb"> </span><span class="nv">\\</span><span class="nb"></span>
</span><span class="line"><span class="nb">      </span><span class="nv">\vdots</span><span class="nb"> </span><span class="nv">\\</span><span class="nb"></span>
</span><span class="line"><span class="nb">      y_n</span>
</span><span class="line"><span class="nb">    </span><span class="nv">\end</span><span class="nb">{array} </span><span class="nv">\right</span><span class="o">)</span><span class="nb"></span>
</span><span class="line"><span class="nv">\end</span><span class="nb">{align</span><span class="o">*</span><span class="nb">}</span>
</span><span class="line"><span class="s">$$</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>will render as</p>

<script type="math/tex; mode=display">% <![CDATA[

\begin{align*}
  & \phi(x,y) = \phi \left(\sum_{i=1}^n x_ie_i, \sum_{j=1}^n y_je_j \right)
  = \sum_{i=1}^n \sum_{j=1}^n x_i y_j \phi(e_i, e_j) = \\
  & (x_1, \ldots, x_n) \left( \begin{array}{ccc}
      \phi(e_1, e_1) & \cdots & \phi(e_1, e_n) \\
      \vdots & \ddots & \vdots \\
      \phi(e_n, e_1) & \cdots & \phi(e_n, e_n)
    \end{array} \right)
  \left( \begin{array}{c}
      y_1 \\
      \vdots \\
      y_n
    \end{array} \right)
\end{align*}
 %]]></script>

<p>And for inline latex code, just use <code>$\exp(-\frac{x^2}{2})$</code>, which will give
$\exp(-\frac{x^2}{2})$.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/14/python-heapq/">Python Heapq</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-14T22:26:00+08:00" pubdate data-updated="true">Aug 14<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class="section" id="introduction">
<h2>Introduction</h2>
<p>The module provides an implementation of heap queue algorithm, also known as
priority queue algorithm.</p>
</div>
<div class="section" id="highlights">
<h2>Highlights</h2>
<ul class="simple">
<li>Zero-based indexing is used, so the children&#8217;s index of node with index k
are (2*k + 1) and (2*k + 2) respectively.</li>
<li>Internally a &#8216;min heap&#8217; is maintained rather than &#8216;max heap&#8217;, which is more
generally used in algorithm textbooks.</li>
<li>Three general functions based on heaps are also provided:</li>
</ul>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="c"># Merge multiple sorted inputs into a single sorted output</span>
</span><span class="line"><span class="c"># (for example, merge timestamped entries from multiple log files)</span>
</span><span class="line"><span class="n">heapq</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="o">*</span><span class="n">iterables</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="c"># The following two functions are effectively like</span>
</span><span class="line"><span class="c"># sorted(iterable, key=key, reverse=True)[:n] and</span>
</span><span class="line"><span class="c"># sorted(iterable, key=key)[:n],</span>
</span><span class="line"><span class="c"># but they perform best with smaller values of n</span>
</span><span class="line"><span class="n">heapq</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">iterable</span><span class="p">[,</span> <span class="n">key</span><span class="p">])</span>
</span><span class="line"><span class="n">heapq</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">iterable</span><span class="p">[,</span> <span class="n">key</span><span class="p">]))</span>
</span></code></pre></td></tr></table></div></figure></div>
<div class="section" id="pythonic-stuff">
<h2>Pythonic stuff</h2>
<div class="section" id="rich-comparison-methods">
<h3>Rich comparison methods</h3>
<figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">def</span> <span class="nf">cmp_lt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span class="line">    <span class="c"># use __lt__ if available; otherwise, try __le__</span>
</span><span class="line">    <span class="k">return</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">&#39;__lt__&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="ow">not</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure><p>In python, there are 6 so called &quot;Rich Comparison&quot; methods, x &lt; y calls
x.__lt__(y) and others are similar (__le__ and &lt;=; __gt__ and &gt;=; __eq__ and ==;
__ne__ and &lt;&gt;). Arguments to rich comparison  methods are never coerced. see
<a class="reference external" href="http://docs.python.org/glossary.html#term-coercion">coercion</a></p>
</div>
</div>
<div class="section" id="code-comments">
<h2>Code comments</h2>
<div class="section" id="why-heapify-x-is-o-n">
<h3>Why heapify(x) is O(n)?</h3>
<p>This is not obvious at first by seeing the code, given that there is a &#8216;while&#8217;
loop in _siftup and also a while loop in _siftdown(called in _siftup). Let&#8217;s
look into it further:</p>
<ol class="arabic simple">
<li>in the while loop of _siftup, it takes O(L) time for nodes that L levels
above leaves.</li>
<li>and in the while loop of _siftdown called in _siftup, it takes at most L
steps, so _siftdown is O(L).</li>
<li>since we have n/4 nodes in level 1, n/8 nodes in level 2, and finally one
root node, which is lg(n) levels above leaf, so the total amount in the while
loop of heapify is:</li>
</ol>
<div class="line-block">
<div class="line"><strong>n/4 * c + n/8 * c + n/16 * 3c + &#8230; + 1 * lg(n) * c</strong>, and let n/4 = 2^k,
after simplification, we get:</div>
<div class="line"><strong>c * 2^k(1/2^0 + 2/2^1 + 3/2^2 + &#8230; + (k+1)/2^k)</strong>, as the limit of
<strong>(k+1)/2^k</strong> is 0 when k is infinite, so the term in the brackets bound to
a constant, from this we can conclude that heapify is O(2^k), which is O(n).</div>
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="why-it-continues-to-find-the-smaller-child-until-a-leaf-is-hit-in-siftup">
<h3>Why it continues to find the smaller child until a leaf is hit in _siftup?</h3>
<p>As explained in the comment by the module author, this is a ad hoc to reduce
the comparisons on the following operations on the heap.</p>
</div>
</div></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/14/intro-on-reading-source-of-python-standard-libraries/">Introduction on Reading Source of Python Standard Libraries Series</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-14T21:11:00+08:00" pubdate data-updated="true">Aug 14<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I am going to start the series of posts on reading the source of python standard
modules. I will go with the pure python modules first, and maybe later I can
continue with C implementations of the modules. Let&#8217;s see how far I could go.</p>
<div class="section" id="what-will-be-included">
<h2>What will be included</h2>
<ul class="simple">
<li>A brief introduction of the module. (It should be very short, people can go to
the standard library doc for more information.)</li>
<li>Special highlights about the important APIs, implementation details.</li>
<li>Python features/idioms/tricks/gotchas that worth the whistle, especially those
I was not familiar with</li>
<li>Detail explanations about the tricky part of the code if any</li>
</ul>
</div>
<div class="section" id="what-will-not-be-included">
<h2>What will not be included</h2>
<ul class="simple">
<li>The example usage of the various APIs, for this kind of stuff,
<a class="reference external" href="http://www.doughellmann.com/PyMOTW/">Python module of the week</a> is a better
place to go</li>
</ul>
<p>Also, alone the way, I may start another series on some specific &#8216;advanced topics&#8217;
in python, like <strong>descriptor</strong>, <strong>decorator</strong>, <strong>method resolution order(mro)</strong>
and so on. Mainly about why they are introduced into python, how they are used and
the typical use cases. This is inspired by the blogs about
<a class="reference external" href="http://python-history.blogspot.com/">python history</a></p>
<p>This post will also be used to track my progress.</p>
</div></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/25/octopress-and-github/">Octopress and Github</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-25T23:21:00+08:00" pubdate data-updated="true">Jul 25<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This post documents how I set up this blog and the problems encounted. Octopress
is quite popular recently and you can just find a huge number of bloggers who
have written about how to set this up online. My main references are
<a class="reference external" href="http://www.gerardcondon.com/blog/2012/03/04/setting-up-octopress-and-github/">Setting up a blog on Octopress and github</a>
and <a class="reference external" href="http://mrzhang.me/blog/blog-equals-github-plus-octopress.html">Blog = Github + Octopress</a> (In Chinese).</p>
</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/07/25/octopress-and-github/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/25/hello-octopress/">Hello Octopress</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-25T02:31:00+08:00" pubdate data-updated="true">Jul 25<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is the first post, using Octopress to set up a tech blog on github is
so cool!</p>

<h2 id="to-do">TO DO:</h2>
<hr />

<ul>
  <li>Add a ‘about’ page serving as the self introduction</li>
  <li>Enable visitors to post comments</li>
  <li>Add useful plugins</li>
  <li>Prepare the post to summarise the process of setting all this things up</li>
</ul>

<h2 id="update-on-2012-07-27">Update on 2012-07-27:</h2>
<hr />

<p>So far, I have finished the basic settings of this blog. The changes include:</p>

<ul>
  <li>Change the default layout and fonts to my preference</li>
  <li>Add jekyll-rst plugin, to use rst rather then markdown by default</li>
  <li>Enable comment</li>
  <li>Add custom asides: category_list, recent_comment, douban and tag cloud</li>
</ul>

</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Categories</h1>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/octopress/'>Octopress (3)</a></li>
<li class='category'><a href='/blog/categories/python/'>Python (3)</a></li>

  </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/08/19/python-bisect/">Python bisect</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/18/supporting-latex-in-octopress/">Support LaTex in Octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/14/python-heapq/">Python heapq</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/14/intro-on-reading-source-of-python-standard-libraries/">Introduction on reading source of python standard libraries series</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/25/octopress-and-github/">Octopress and Github</a>
      </li>
    
  </ul>
</section>
<section>
    <h1>Recent Comments</h1>
        <div id="dsq-recentcomments" class="dsq-widget">
            <script type="text/javascript" src="http://disqus.com/forums/chaoc/recent_comments_widget.js?hide_avatars=1">
            </script>
        </div>
</section>

<section>
    <h2>Reading List</h2>
    <div>
        <script type="text/javascript" src="http://www.douban.com/service/badge/3607474/?show=dolist&amp;n=6&amp;columns=3&amp;hidelogo=yes&amp;cat=book" >
        </script>
    </div>
</section>

<section>
  <h1>Tags</h1>
  <ul class="tag-cloud">
    <a style="font-size: 90%" href="/blog/tags/binary-search/">binary search</a>
<a style="font-size: 90%" href="/blog/tags/bisect/">bisect</a>
<a style="font-size: 90%" href="/blog/tags/blog/">blog</a>
<a style="font-size: 90%" href="/blog/tags/github/">github</a>
<a style="font-size: 90%" href="/blog/tags/heap/">heap</a>
<a style="font-size: 90%" href="/blog/tags/kramdown/">kramdown</a>
<a style="font-size: 90%" href="/blog/tags/latex/">latex</a>
<a style="font-size: 210%" href="/blog/tags/octopress/">octopress</a>
<a style="font-size: 90%" href="/blog/tags/priority-queue/">priority queue</a>
<a style="font-size: 210%" href="/blog/tags/python/">python</a>

  </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Chao Chu -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'chaoc';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
